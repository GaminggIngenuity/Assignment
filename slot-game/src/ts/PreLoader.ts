import {
  ILoaderResource,
  Loader,
} from 'pixi.js';
import { setResources } from './Textures';
import { Assets } from './assets';

function addAssets(loader:Loader, assets: {key:string, url:string}[]):void {
  assets.forEach((asset) => {
    loader.add(asset);
  });
}
export type ResourceType = {[key:string]: ILoaderResource };

let progDiv: HTMLDivElement;
function showProgress(e: any) {
  if (progDiv === undefined) {
    progDiv = document.querySelector('.progress') as HTMLDivElement;
  }
  progDiv.style.width = `${e.progress}%`;
}

function loadComplete(
  loader:Loader,
  resources: ResourceType,
  onCompleteCallback:(l:Loader, r: ResourceType)=>void,
): void {
  setResources(resources);
  setTimeout(() => {
    (<HTMLDivElement>document.querySelector('#bar')).style.visibility = 'hidden';//
    (<HTMLDivElement>document.querySelector('#message')).innerHTML =  '<button id="btn"><b>Click here to start...</b></button>';//'<img src="data:image/png;base64,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">';
    const preloader = (<HTMLDivElement>document.querySelector('#preloader'));
    preloader.onclick = (e) => {
      console.log('event ', e);
      preloader.style.display = 'none';
      // document.removeChild(preloader);
      onCompleteCallback(loader, resources);
    };
  }, 1000);
}

export function preLoader(
  assetList: Assets,
  callback: (l?:Loader, r?: ResourceType) => void,
): Loader {
  const loader = Loader.shared;
  if (assetList.baseUrl) {
    loader.baseUrl = assetList.baseUrl;
  }
  addAssets(loader, assetList.images);
  loader.onProgress.add(showProgress);
  loader.onComplete.add((l:Loader, res) => {
    console.warn('loader', l, 'res ', res);
    loadComplete(l, res as any, callback);
  });
  loader.load();
  return loader;
}
